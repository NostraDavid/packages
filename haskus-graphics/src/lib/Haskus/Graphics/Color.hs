module Haskus.Graphics.Color
   ( stdObs1931
   , stdObs1964
   , stdIlluminantA
   , stdIlluminantD65
   , daylightComponents
   )
where

import Data.Ratio

-- | Note [Colors]
-- ~~~~~~~~~~~~~~~
--
--  Source:
--    * https://en.wikipedia.org/wiki/CIE_1931_color_space
--    * https://en.wikipedia.org/wiki/Standard_illuminant
--    * http://www.handprint.com/HP/WCL/color1.html
--
-- Visible spectrum
-- ================
--
-- 360nm -> 830nm in standard air (dry air at 15Â°C and 103125 Pa)
--
-- The frequence of a color is stable across the different physical environment
-- while the wavelength isn't (e.g. 800nm is red in the air but 600 nm is red in
-- the water).
-- 
-- Spectral Power Distribution (SPD)
-- =================================
-- 
-- Characterise a light source: radiant power emitted by the light source at
-- each wavelength (or band of wavelengths) over the visible spectrum.
--
--
-- Color perception
-- ================
--
-- The human eye contains 3 kinds of cones whose peaks correspond roughly to
-- blue, green and red wavelengths. The three responses overlap. It also
-- contains rods for night vision but its contribution is often negligible.
--
-- LMS color space
-- ===============
--
-- The red, green and blue response curves are also known as LMS for
-- Long/Short/Medium wavelengths. The LMS colors space is derived from these
-- curves.
--
-- Luminance/brightness
-- ====================
--
-- The luminance is roughly analogous to the spectral sensitivity of M (green)
-- cones.
--
-- CIE XYZ
-- =======
--
-- The CIE XYZ color space was deliberately designed so that the Y parameter is
-- a measure of the luminance of a color.
--
-- CIE xyY
-- =======
--
-- We can derive CIE xyY color space from CIE XYZ with:
--    x = X / (X+Y+Z)
--    y = Y / (X+Y+Z)
--    z = Z / (X+Y+Z) = 1 - x - y
--
-- Hence x and y are in the range [0,1.0] and represent the chromaticity of the
-- color while Y is its brightness/luminance.
--
-- X and Z can be computed back with:
--    X = Y * x / y
--    Z = (Y/y) * (1 - x - y)
--
-- White
-- =====
--
-- There is no single white. CIE defines "equal energy white" (CIE Illuminant E)
-- as an SPD that has equal intensity at every wavelength in the visible
-- spectrum. The CIE 1931 color matching functions are each normalized so their
-- integrals over the visible spectrum are all equal. This means the tristimulus
-- values for E are equal:
--    X=Y=Z (hence x=y=z=1/3).
--
-- More realistic whites are defined:
--    * D65: dyalight
--    * D50: used in print industry
--    * D55: used in photography
--
-- CIE diagram/hue/saturation
-- ==========================
--
-- A CIE diagram is a plot of (x,y) for Y fixed. It has a tongue shape: the base
-- is the "purple line" and the curve side is called the "spectrum locus".
--
-- For a given color c, we can draw a line (c,E).
--    * The intersection of this line with the spectrum locus is the dominant
--    wavelength (or hue)
--    * The relative distance between E and c is the purity (or saturation). If
--    saturation is 0, it's E. If the saturation is 1.0, it's the single
--    wavelength color (on the spectrum locus).
--
-- Mixing colors
-- =============
-- 
-- Linear combinations of tristimulus values (X,Y,Z) are also tristimulus
-- values.
--
-- CIE xyY colors can be mixed with the following formulae:
--
--    xm = sum (xi*Yi/yi) / sum (Yi/yi)
--    ym = sum (Yi) / sum (Yi/yi)
--    Ym = sum (Yi)

-- | CIE 1931 standard colorimetric observer
-- /x,/y,/z from 380 to 780nm, 5nm step
stdObs1931 :: [(Ratio Word,Ratio Word, Ratio Word)]
stdObs1931 =
   [(0.001368, 0.000039, 0.006450)
   ,(0.002236, 0.000064, 0.010550)
   ,(0.004243, 0.000120, 0.020050)
   ,(0.007650, 0.000217, 0.036210)
   ,(0.014310, 0.000396, 0.067850)
   ,(0.023190, 0.000640, 0.110200)
   ,(0.043510, 0.001210, 0.207400)
   ,(0.077630, 0.002180, 0.371300)
   ,(0.134380, 0.004000, 0.645600)
   ,(0.214770, 0.007300, 1.039050)
   ,(0.283900, 0.011600, 1.385600)
   ,(0.328500, 0.016840, 1.622960)
   ,(0.348280, 0.023000, 1.747060)
   ,(0.348060, 0.029800, 1.782600)
   ,(0.336200, 0.038000, 1.772110)
   ,(0.318700, 0.048000, 1.744100)
   ,(0.290800, 0.060000, 1.669200)
   ,(0.251100, 0.073900, 1.528100)
   ,(0.195360, 0.090980, 1.287640)
   ,(0.142100, 0.112600, 1.041900)
   ,(0.095640, 0.139020, 0.812950)
   ,(0.057950, 0.169300, 0.616200)
   ,(0.032010, 0.208020, 0.465180)
   ,(0.014700, 0.258600, 0.353300)
   ,(0.004900, 0.323000, 0.272000)
   ,(0.002400, 0.407300, 0.212300)
   ,(0.009300, 0.503000, 0.158200)
   ,(0.029100, 0.608200, 0.111700)
   ,(0.063270, 0.710000, 0.078250)
   ,(0.109600, 0.793200, 0.057250)
   ,(0.165500, 0.862000, 0.042160)
   ,(0.225750, 0.914850, 0.029840)
   ,(0.290400, 0.954000, 0.020300)
   ,(0.359700, 0.980300, 0.013400)
   ,(0.433450, 0.994950, 0.008750)
   ,(0.512050, 1.000000, 0.005750)
   ,(0.594500, 0.995000, 0.003900)
   ,(0.678400, 0.978600, 0.002750)
   ,(0.762100, 0.952000, 0.002100)
   ,(0.842500, 0.915400, 0.001800)
   ,(0.916300, 0.870000, 0.001650)
   ,(0.978600, 0.816300, 0.001400)
   ,(1.026300, 0.757000, 0.001100)
   ,(1.056700, 0.694900, 0.001000)
   ,(1.062200, 0.631000, 0.000800)
   ,(1.045600, 0.566800, 0.000600)
   ,(1.002600, 0.503000, 0.000340)
   ,(0.938400, 0.441200, 0.000240)
   ,(0.854450, 0.381000, 0.000190)
   ,(0.751400, 0.321000, 0.000100)
   ,(0.642400, 0.265000, 0.000050)
   ,(0.541900, 0.217000, 0.000030)
   ,(0.447900, 0.175000, 0.000020)
   ,(0.360800, 0.138200, 0.000010)
   ,(0.283500, 0.107000, 0.000000)
   ,(0.218700, 0.081600, 0.000000)
   ,(0.164900, 0.061000, 0.000000)
   ,(0.121200, 0.044580, 0.000000)
   ,(0.087400, 0.032000, 0.000000)
   ,(0.063600, 0.023200, 0.000000)
   ,(0.046770, 0.017000, 0.000000)
   ,(0.032900, 0.011920, 0.000000)
   ,(0.022700, 0.008210, 0.000000)
   ,(0.015840, 0.005723, 0.000000)
   ,(0.011359, 0.004102, 0.000000)
   ,(0.008111, 0.002929, 0.000000)
   ,(0.005790, 0.002091, 0.000000)
   ,(0.004109, 0.001484, 0.000000)
   ,(0.002899, 0.001047, 0.000000)
   ,(0.002049, 0.000740, 0.000000)
   ,(0.001440, 0.000520, 0.000000)
   ,(0.001000, 0.000361, 0.000000)
   ,(0.000690, 0.000249, 0.000000)
   ,(0.000476, 0.000172, 0.000000)
   ,(0.000332, 0.000120, 0.000000)
   ,(0.000235, 0.000085, 0.000000)
   ,(0.000166, 0.000060, 0.000000)
   ,(0.000117, 0.000042, 0.000000)
   ,(0.000083, 0.000030, 0.000000)
   ,(0.000059, 0.000021, 0.000000)
   ,(0.000042, 0.000015, 0.000000)
   ]

-- | CIE 1964 standard colorimetric observer
-- /x10,/y10,/z10 from 380 to 780nm, 5nm step
stdObs1964 :: [(Ratio Word,Ratio Word, Ratio Word)]
stdObs1964 =
   [ (0.000160, 0.000017, 0.000705)
   , (0.000662, 0.000072, 0.002928)
   , (0.002362, 0.000253, 0.010482)
   , (0.007242, 0.000769, 0.032344)
   , (0.019110, 0.002004, 0.086011)
   , (0.043400, 0.004509, 0.197120)
   , (0.084736, 0.008756, 0.389366)
   , (0.140638, 0.014456, 0.656760)
   , (0.204492, 0.021391, 0.972542)
   , (0.264737, 0.029497, 1.282500)
   , (0.314679, 0.038676, 1.553480)
   , (0.357719, 0.049602, 1.798500)
   , (0.383734, 0.062077, 1.967280)
   , (0.386726, 0.074704, 2.027300)
   , (0.370702, 0.089456, 1.994800)
   , (0.342957, 0.106256, 1.900700)
   , (0.302273, 0.128201, 1.745370)
   , (0.254085, 0.152761, 1.554900)
   , (0.195618, 0.185190, 1.317560)
   , (0.132349, 0.219940, 1.030200)
   , (0.080507, 0.253589, 0.772125)
   , (0.041072, 0.297665, 0.570060)
   , (0.016172, 0.339133, 0.415254)
   , (0.005132, 0.395379, 0.302356)
   , (0.003816, 0.460777, 0.218502)
   , (0.015444, 0.531360, 0.159249)
   , (0.037465, 0.606741, 0.112044)
   , (0.071358, 0.685660, 0.082248)
   , (0.117749, 0.761757, 0.060709)
   , (0.172953, 0.823330, 0.043050)
   , (0.236491, 0.875211, 0.030451)
   , (0.304213, 0.923810, 0.020584)
   , (0.376772, 0.961988, 0.013676)
   , (0.451584, 0.982200, 0.007918)
   , (0.529826, 0.991761, 0.003988)
   , (0.616053, 0.999110, 0.001091)
   , (0.705224, 0.997340, 0.000000)
   , (0.793832, 0.982380, 0.000000)
   , (0.878655, 0.955552, 0.000000)
   , (0.951162, 0.915175, 0.000000)
   , (1.014160, 0.868934, 0.000000)
   , (1.074300, 0.825623, 0.000000)
   , (1.118520, 0.777405, 0.000000)
   , (1.134300, 0.720353, 0.000000)
   , (1.123990, 0.658341, 0.000000)
   , (1.089100, 0.593878, 0.000000)
   , (1.030480, 0.527963, 0.000000)
   , (0.950740, 0.461834, 0.000000)
   , (0.856297, 0.398057, 0.000000)
   , (0.754930, 0.339554, 0.000000)
   , (0.647467, 0.283493, 0.000000)
   , (0.535110, 0.228254, 0.000000)
   , (0.431567, 0.179828, 0.000000)
   , (0.343690, 0.140211, 0.000000)
   , (0.268329, 0.107633, 0.000000)
   , (0.204300, 0.081187, 0.000000)
   , (0.152568, 0.060281, 0.000000)
   , (0.112210, 0.044096, 0.000000)
   , (0.081261, 0.031800, 0.000000)
   , (0.057930, 0.022602, 0.000000)
   , (0.040851, 0.015905, 0.000000)
   , (0.028623, 0.011130, 0.000000)
   , (0.019941, 0.007749, 0.000000)
   , (0.013842, 0.005375, 0.000000)
   , (0.009577, 0.003718, 0.000000)
   , (0.006605, 0.002565, 0.000000)
   , (0.004553, 0.001768, 0.000000)
   , (0.003145, 0.001222, 0.000000)
   , (0.002175, 0.000846, 0.000000)
   , (0.001506, 0.000586, 0.000000)
   , (0.001045, 0.000407, 0.000000)
   , (0.000727, 0.000284, 0.000000)
   , (0.000508, 0.000199, 0.000000)
   , (0.000356, 0.000140, 0.000000)
   , (0.000251, 0.000098, 0.000000)
   , (0.000178, 0.000070, 0.000000)
   , (0.000126, 0.000050, 0.000000)
   , (0.000090, 0.000036, 0.000000)
   , (0.000065, 0.000025, 0.000000)
   , (0.000046, 0.000018, 0.000000)
   , (0.000033, 0.000013, 0.000000)
   ]

-- | Relative spectral power distribution of CIE Standard Illuminant A
-- From 300 to 780nm (5nm step)
stdIlluminantA :: [Ratio Word]
stdIlluminantA =
   [ 0.930483
   , 1.128210
   , 1.357690
   , 1.622190
   , 1.925080
   , 2.269800
   , 2.659810
   , 3.098610
   , 3.589680
   , 4.136480
   , 4.742380
   , 5.410700
   , 6.144620
   , 6.947200
   , 7.821350
   , 8.769800
   , 9.795100
   , 10.899600
   , 12.085300
   , 13.354300
   , 14.708000
   , 16.148000
   , 17.675300
   , 19.290700
   , 20.995000
   , 22.788300
   , 24.670900
   , 26.642500
   , 28.702700
   , 30.850800
   , 33.085900
   , 35.406800
   , 37.812100
   , 40.300200
   , 42.869300
   , 45.517400
   , 48.242300
   , 51.041800
   , 53.913200
   , 56.853900
   , 59.861100
   , 62.932000
   , 66.063500
   , 69.252500
   , 72.495900
   , 75.790300
   , 79.132600
   , 82.519300
   , 85.947000
   , 89.412400
   , 92.912000
   , 96.442300
   , 100.000000
   , 103.582000
   , 107.184000
   , 110.803000
   , 114.436000
   , 118.080000
   , 121.731000
   , 125.386000
   , 129.043000
   , 132.697000
   , 136.346000
   , 139.988000
   , 143.618000
   , 147.235000
   , 150.836000
   , 154.418000
   , 157.979000
   , 161.516000
   , 165.028000
   , 168.510000
   , 171.963000
   , 175.383000
   , 178.769000
   , 182.118000
   , 185.429000
   , 188.701000
   , 191.931000
   , 195.118000
   , 198.261000
   , 201.359000
   , 204.409000
   , 207.411000
   , 210.365000
   , 213.268000
   , 216.120000
   , 218.920000
   , 221.667000
   , 224.361000
   , 227.000000
   , 229.585000
   , 232.115000
   , 234.589000
   , 237.008000
   , 239.370000
   , 241.675000
   ]

-- | Relative spectral power distribution of CIE Standard Illuminant D65
-- From 300 to 780nm (5nm step)
stdIlluminantD65 :: [Ratio Word]
stdIlluminantD65 =
   [ 0.034100
   , 1.664300
   , 3.294500
   , 11.765200
   , 20.236000
   , 28.644700
   , 37.053500
   , 38.501100
   , 39.948800
   , 42.430200
   , 44.911700
   , 45.775000
   , 46.638300
   , 49.363700
   , 52.089100
   , 51.032300
   , 49.975500
   , 52.311800
   , 54.648200
   , 68.701500
   , 82.754900
   , 87.120400
   , 91.486000
   , 92.458900
   , 93.431800
   , 90.057000
   , 86.682300
   , 95.773600
   , 104.865000
   , 110.936000
   , 117.008000
   , 117.410000
   , 117.812000
   , 116.336000
   , 114.861000
   , 115.392000
   , 115.923000
   , 112.367000
   , 108.811000
   , 109.082000
   , 109.354000
   , 108.578000
   , 107.802000
   , 106.296000
   , 104.790000
   , 106.239000
   , 107.689000
   , 106.047000
   , 104.405000
   , 104.225000
   , 104.046000
   , 102.023000
   , 100.000000
   , 98.167100
   , 96.334200
   , 96.061100
   , 95.788000
   , 92.236800
   , 88.685600
   , 89.345900
   , 90.006200
   , 89.802600
   , 89.599100
   , 88.648900
   , 87.698700
   , 85.493600
   , 83.288600
   , 83.493900
   , 83.699200
   , 81.863000
   , 80.026800
   , 80.120700
   , 80.214600
   , 81.246200
   , 82.277800
   , 80.281000
   , 78.284200
   , 74.002700
   , 69.721300
   , 70.665200
   , 71.609100
   , 72.979000
   , 74.349000
   , 67.976500
   , 61.604000
   , 65.744800
   , 69.885600
   , 72.486300
   , 75.087000
   , 69.339800
   , 63.592700
   , 55.005400
   , 46.418200
   , 56.611800
   , 66.805400
   , 65.094100
   , 63.382800
   , 63.843400
   , 64.304000
   , 61.877900
   , 59.451900
   , 55.705400
   , 51.959000
   , 54.699800
   , 57.440600
   , 58.876500
   , 60.312500
   ]

-- | Daylight components (S0,S1,S2) from 300nm to 830nm
daylightComponents :: [(Ratio Int, Ratio Int, Ratio Int)]
daylightComponents =
   [ (0.04  ,  0.02  , 0.00 )
   , (3.02  ,  2.26  , 1.00 )
   , (6.00  ,  4.50  , 2.00 )
   , (17.80 ,  13.45 , 3.00 )
   , (29.60 ,  22.40 , 4.00 )
   , (42.45 ,  32.20 , 6.25 )
   , (55.30 ,  42.00 , 8.50 )
   , (56.30 ,  41.30 , 8.15 )
   , (57.30 ,  40.60 , 7.80 )
   , (59.55 ,  41.10 , 7.25 )
   , (61.80 ,  41.60 , 6.70 )
   , (61.65 ,  39.80 , 6.00 )
   , (61.50 ,  38.00 , 5.30 )
   , (65.15 ,  40.20 , 5.70 )
   , (68.80 ,  42.40 , 6.10 )
   , (66.10 ,  40.45 , 4.55 )
   , (63.40 ,  38.50 , 3.00 )
   , (64.60 ,  36.75 , 2.10 )
   , (65.80 ,  35.00 , 1.20 )
   , (80.30 ,  39.20 , 0.05 )
   , (94.80 ,  43.40 , -1.10)
   , (99.80 ,  44.85 , -0.80)
   , (104.80,  46.30 , -0.50)
   , (105.35,  45.10 , -0.60)
   , (105.90,  43.90 , -0.70)
   , (101.35,  40.50 , -0.95)
   , (96.80 ,  37.10 , -1.20)
   , (105.35,  36.90 , -1.90)
   , (113.90,  36.70 , -2.60)
   , (119.75,  36.30 , -2.75)
   , (125.60,  35.90 , -2.90)
   , (125.55,  34.25 , -2.85)
   , (125.50,  32.60 , -2.80)
   , (123.40,  30.25 , -2.70)
   , (121.30,  27.90 , -2.60)
   , (121.30,  26.10 , -2.60)
   , (121.30,  24.30 , -2.60)
   , (117.40,  22.20 , -2.20)
   , (113.50,  20.10 , -1.80)
   , (113.30,  18.15 , -1.65)
   , (113.10,  16.20 , -1.50)
   , (111.95,  14.70 , -1.40)
   , (110.80,  13.20 , -1.30)
   , (108.65,  10.90 , -1.25)
   , (106.50,  8.60  , -1.20)
   , (107.65,  7.35  , -1.10)
   , (108.80,  6.10  , -1.00)
   , (107.05,  5.15  , -0.75)
   , (105.30,  4.20  , -0.50)
   , (104.85,  3.05  , -0.40)
   , (104.40,  1.90  , -0.30)
   , (102.20,  0.95  , -0.15)
   , (100.00,  0.00  , 0.00 )
   , (98.00 , -0.80  , 0.10 )
   , (96.00 , -1.60  , 0.20 )
   , (95.55 , -2.55  , 0.35 )
   , (95.10 , -3.50  , 0.50 )
   , (92.10 , -3.50  , 1.30 )
   , (89.10 , -3.50  , 2.10 )
   , (89.80 , -4.65  , 2.65 )
   , (90.50 , -5.80  , 3.20 )
   , (90.40 , -6.50  , 3.65 )
   , (90.30 , -7.20  , 4.10 )
   , (89.35 , -7.90  , 4.40 )
   , (88.40 , -8.60  , 4.70 )
   , (86.20 , -9.05  , 4.90 )
   , (84.00 , -9.50  , 5.10 )
   , (84.55 , -10.20 , 5.90 )
   , (85.10 , -10.90 , 6.70 )
   , (83.50 , -10.80 , 7.00 )
   , (81.90 , -10.70 , 7.30 )
   , (82.25 , -11.35 , 7.95 )
   , (82.60 , -12.00 , 8.60 )
   , (83.75 , -13.00 , 9.20 )
   , (84.90 , -14.00 , 9.80 )
   , (83.10 , -13.80 , 10.00)
   , (81.30 , -13.60 , 10.20)
   , (76.60 , -12.80 , 9.25 )
   , (71.90 , -12.00 , 8.30 )
   , (73.10 , -12.65 , 8.95 )
   , (74.30 , -13.30 , 9.60 )
   , (75.35 , -13.10 , 9.05 )
   , (76.40 , -12.90 , 8.50 )
   , (69.85 , -11.75 , 7.75 )
   , (63.30 , -10.60 , 7.00 )
   , (67.50 , -11.10 , 7.30 )
   , (71.70 , -11.60 , 7.60 )
   , (74.35 , -11.90 , 7.80 )
   , (77.00 , -12.20 , 8.00 )
   , (71.10 , -11.20 , 7.35 )
   , (65.20 , -10.20 , 6.70 )
   , (56.45 , -9.00  , 5.95 )
   , (47.70 , -7.80  , 5.20 )
   , (58.15 , -9.50  , 6.30 )
   , (68.60 , -11.20 , 7.40 )
   , (66.80 , -10.80 , 7.10 )
   , (65.00 , -10.40 , 6.80 )
   , (65.50 , -10.50 , 6.90 )
   , (66.00 , -10.60 , 7.00 )
   , (63.50 , -10.15 , 6.70 )
   , (61.00 , -9.70  , 6.40 )
   , (57.15 , -9.00  , 5.95 )
   , (53.30 , -8.30  , 5.50 )
   , (56.10 , -8.80  , 5.80 )
   , (58.90 , -9.30  , 6.10 )
   , (60.40 , -9.55  , 6.30 )
   , (61.90 , -9.80  , 6.50 )
   ]
